<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <!-- Security Categories -->
        <record id="module_category_scientific_project" model="ir.module.category">
            <field name="name">Scientific Project</field>
            <field name="description">Manage access rights for Scientific Project Manager</field>
            <field name="sequence">10</field>
        </record>

        <!-- Admin Access Rules (Override all restrictions for system administrators) -->
        <record id="rule_admin_all_projects" model="ir.rule">
            <field name="name">Admin: Full Project Access</field>
            <field name="model_id" ref="model_scientific_project"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <record id="rule_admin_all_tasks" model="ir.rule">
            <field name="name">Admin: Full Task Access</field>
            <field name="model_id" ref="model_scientific_task"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <record id="rule_admin_all_experiments" model="ir.rule">
            <field name="name">Admin: Full Experiment Access</field>
            <field name="model_id" ref="model_scientific_experiment"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <record id="rule_admin_all_documents" model="ir.rule">
            <field name="name">Admin: Full Document Access</field>
            <field name="model_id" ref="model_scientific_document"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <record id="rule_admin_all_researchers" model="ir.rule">
            <field name="name">Admin: Full Researcher Access</field>
            <field name="model_id" ref="model_scientific_researcher"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <record id="rule_admin_all_data" model="ir.rule">
            <field name="name">Admin: Full Data Management Access</field>
            <field name="model_id" ref="model_scientific_data_management"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <record id="rule_admin_all_equipment" model="ir.rule">
            <field name="name">Admin: Full Equipment Access</field>
            <field name="model_id" ref="model_scientific_equipment"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <record id="rule_admin_all_reagents" model="ir.rule">
            <field name="name">Admin: Full Reagent Access</field>
            <field name="model_id" ref="model_scientific_reagent"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <record id="rule_admin_all_schedules" model="ir.rule">
            <field name="name">Admin: Full Schedule Access</field>
            <field name="model_id" ref="model_scientific_schedule"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <record id="rule_admin_all_publications" model="ir.rule">
            <field name="name">Admin: Full Publication Access</field>
            <field name="model_id" ref="model_scientific_publication"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <record id="rule_admin_all_partners" model="ir.rule">
            <field name="name">Admin: Full Partner Access</field>
            <field name="model_id" ref="model_scientific_partner"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <record id="rule_admin_all_funding" model="ir.rule">
            <field name="name">Admin: Full Funding Access</field>
            <field name="model_id" ref="model_scientific_funding"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <record id="rule_admin_all_tags" model="ir.rule">
            <field name="name">Admin: Full Tags Access</field>
            <field name="model_id" ref="model_scientific_tags"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('base.group_system'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <!-- Security Groups -->

        <!-- Guest/Observer: Read-only access -->
        <record id="group_scientific_observer" model="res.groups">
            <field name="name">Observer</field>
            <field name="category_id" ref="module_category_scientific_project"/>
            <field name="comment">Read-only access to scientific projects and data</field>
        </record>

        <!-- Laboratory Technician: Equipment and Reagent management -->
        <record id="group_scientific_technician" model="res.groups">
            <field name="name">Laboratory Technician</field>
            <field name="category_id" ref="module_category_scientific_project"/>
            <field name="implied_ids" eval="[(4, ref('group_scientific_observer'))]"/>
            <field name="comment">Manage equipment, reagents, and schedules</field>
        </record>

        <!-- Researcher: Read/Write own assignments -->
        <record id="group_scientific_researcher" model="res.groups">
            <field name="name">Researcher</field>
            <field name="category_id" ref="module_category_scientific_project"/>
            <field name="implied_ids" eval="[(4, ref('group_scientific_technician'))]"/>
            <field name="comment">Create and manage own experiments and tasks</field>
        </record>

        <!-- Principal Investigator: Full project access, limited admin -->
        <record id="group_scientific_pi" model="res.groups">
            <field name="name">Principal Investigator</field>
            <field name="category_id" ref="module_category_scientific_project"/>
            <field name="implied_ids" eval="[(4, ref('group_scientific_researcher'))]"/>
            <field name="comment">Full access to projects and team management</field>
        </record>

        <!-- Scientific Project Manager: Full access -->
        <record id="group_scientific_manager" model="res.groups">
            <field name="name">Manager</field>
            <field name="category_id" ref="module_category_scientific_project"/>
            <field name="implied_ids" eval="[(4, ref('group_scientific_pi'))]"/>
            <field name="comment">Full administrative access to all features</field>
        </record>

        <!-- Record Rules for Data Isolation -->

        <!-- Projects: Users see projects they're involved in -->
        <record id="rule_scientific_project_observer" model="ir.rule">
            <field name="name">Scientific Project: Observer</field>
            <field name="model_id" ref="model_scientific_project"/>
            <field name="domain_force">[('id', 'in', [])]</field>
            <field name="groups" eval="[(4, ref('group_scientific_observer'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="0"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
        </record>

        <record id="rule_scientific_project_researcher" model="ir.rule">
            <field name="name">Scientific Project: Researcher</field>
            <field name="model_id" ref="model_scientific_project"/>
            <field name="domain_force">['|', '|',
                ('principal_investigator_id.user_id', '=', user.id),
                ('collaborators_ids.user_id', '=', user.id),
                ('experiment_ids.assigned_to_ids.user_id', '=', user.id)]
            </field>
            <field name="groups" eval="[(4, ref('group_scientific_researcher'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="0"/>
        </record>

        <record id="rule_scientific_project_manager" model="ir.rule">
            <field name="name">Scientific Project: Manager</field>
            <field name="model_id" ref="model_scientific_project"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_manager'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <!-- Experiments: Users see experiments they're assigned to -->
        <record id="rule_scientific_experiment_researcher" model="ir.rule">
            <field name="name">Scientific Experiment: Researcher</field>
            <field name="model_id" ref="model_scientific_experiment"/>
            <field name="domain_force">['|',
                ('assigned_to_ids.user_id', '=', user.id),
                ('project_id.principal_investigator_id.user_id', '=', user.id)]
            </field>
            <field name="groups" eval="[(4, ref('group_scientific_researcher'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="0"/>
        </record>

        <record id="rule_scientific_experiment_manager" model="ir.rule">
            <field name="name">Scientific Experiment: Manager</field>
            <field name="model_id" ref="model_scientific_experiment"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_manager'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <!-- Data Management: Access based on data access level -->
        <record id="rule_scientific_data_researcher" model="ir.rule">
            <field name="name">Scientific Data: Researcher</field>
            <field name="model_id" ref="model_scientific_data_management"/>
            <field name="domain_force">['|', '|',
                ('researcher_id.user_id', '=', user.id),
                ('access_level', 'in', ['team', 'organization', 'public']),
                ('project_id.collaborators_ids.user_id', '=', user.id)]
            </field>
            <field name="groups" eval="[(4, ref('group_scientific_researcher'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="0"/>
        </record>

        <record id="rule_scientific_data_manager" model="ir.rule">
            <field name="name">Scientific Data: Manager</field>
            <field name="model_id" ref="model_scientific_data_management"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_manager'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <!-- Equipment: Technicians and above can manage -->
        <record id="rule_scientific_equipment_technician" model="ir.rule">
            <field name="name">Scientific Equipment: Technician</field>
            <field name="model_id" ref="model_scientific_equipment"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_technician'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="0"/>
        </record>

        <record id="rule_scientific_equipment_manager" model="ir.rule">
            <field name="name">Scientific Equipment: Manager</field>
            <field name="model_id" ref="model_scientific_equipment"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_manager'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
        </record>

        <!-- PROJECT RULES -->
        <!-- Managers can see all projects -->
        <record id="scientific_project_manager_rule" model="ir.rule">
            <field name="name">Project: Manager Access</field>
            <field name="model_id" ref="model_scientific_project"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Users can only see projects they're involved in -->
        <record id="scientific_project_user_rule" model="ir.rule">
            <field name="name">Project: User Access</field>
            <field name="model_id" ref="model_scientific_project"/>
            <field name="domain_force">[
                '|',
                ('principal_investigator_id.user_id', '=', user.id),
                ('collaborators_ids.user_id', 'in', [user.id])
            ]</field>
            <field name="groups" eval="[(4, ref('group_scientific_researcher'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Read-only users can only view projects they're involved in -->
        <record id="scientific_project_readonly_rule" model="ir.rule">
            <field name="name">Project: Read Only Access</field>
            <field name="model_id" ref="model_scientific_project"/>
            <field name="domain_force">[
                '|',
                ('principal_investigator_id.user_id', '=', user.id),
                ('collaborators_ids.user_id', 'in', [user.id])
            ]</field>
            <field name="groups" eval="[(4, ref('group_scientific_observer'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- TASK RULES -->
        <!-- Managers can see all tasks -->
        <record id="scientific_task_manager_rule" model="ir.rule">
            <field name="name">Task: Manager Access</field>
            <field name="model_id" ref="model_scientific_task"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_manager'))]"/>
        </record>

        <!-- Users can see tasks they're assigned to -->
        <record id="scientific_task_user_rule" model="ir.rule">
            <field name="name">Task: User Access</field>
            <field name="model_id" ref="model_scientific_task"/>
            <field name="domain_force">[('assigned_to_ids.user_id', 'in', [user.id])]</field>
            <field name="groups" eval="[(4, ref('group_scientific_researcher'))]"/>
        </record>

        <!-- EXPERIMENT RULES -->
        <!-- Managers can see all experiments -->
        <record id="scientific_experiment_manager_rule" model="ir.rule">
            <field name="name">Experiment: Manager Access</field>
            <field name="model_id" ref="model_scientific_experiment"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_manager'))]"/>
        </record>

        <!-- Users can see experiments they're assigned to -->
        <record id="scientific_experiment_user_rule" model="ir.rule">
            <field name="name">Experiment: User Access</field>
            <field name="model_id" ref="model_scientific_experiment"/>
            <field name="domain_force">[('assigned_to_ids.user_id', 'in', [user.id])]</field>
            <field name="groups" eval="[(4, ref('group_scientific_researcher'))]"/>
        </record>

        <!-- DOCUMENT RULES -->
        <!-- Managers can see all documents -->
        <record id="scientific_document_manager_rule" model="ir.rule">
            <field name="name">Document: Manager Access</field>
            <field name="model_id" ref="model_scientific_document"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_manager'))]"/>
        </record>

        <!-- Users can see documents based on confidentiality level -->
        <record id="scientific_document_user_rule" model="ir.rule">
            <field name="name">Document: User Access</field>
            <field name="model_id" ref="model_scientific_document"/>
            <field name="domain_force">[
                '|',
                ('confidentiality_level', 'in', ['public', 'internal', False]),
                '|',
                ('author_ids.user_id', 'in', [user.id]),
                ('project_id.collaborators_ids.user_id', 'in', [user.id])
            ]</field>
            <field name="groups" eval="[(4, ref('group_scientific_researcher'))]"/>
        </record>

        <!-- RESEARCHER RULES -->
        <!-- Managers can see all researchers -->
        <record id="scientific_researcher_manager_rule" model="ir.rule">
            <field name="name">Researcher: Manager Access</field>
            <field name="model_id" ref="model_scientific_researcher"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_manager'))]"/>
        </record>

        <!-- Users can see all researchers (for collaboration) -->
        <record id="scientific_researcher_user_rule" model="ir.rule">
            <field name="name">Researcher: User Access</field>
            <field name="model_id" ref="model_scientific_researcher"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_researcher'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- EQUIPMENT RULES -->
        <!-- Managers can see all equipment -->
        <record id="scientific_equipment_manager_rule" model="ir.rule">
            <field name="name">Equipment: Manager Access</field>
            <field name="model_id" ref="model_scientific_equipment"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_manager'))]"/>
        </record>

        <!-- Users can see all equipment (for reservation) -->
        <record id="scientific_equipment_user_rule" model="ir.rule">
            <field name="name">Equipment: User Access</field>
            <field name="model_id" ref="model_scientific_equipment"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_researcher'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- REAGENT RULES -->
        <!-- Managers can see all reagents -->
        <record id="scientific_reagent_manager_rule" model="ir.rule">
            <field name="name">Reagent: Manager Access</field>
            <field name="model_id" ref="model_scientific_reagent"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_manager'))]"/>
        </record>

        <!-- Users can see all reagents -->
        <record id="scientific_reagent_user_rule" model="ir.rule">
            <field name="name">Reagent: User Access</field>
            <field name="model_id" ref="model_scientific_reagent"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_researcher'))]"/>
        </record>

        <!-- SCHEDULE RULES -->
        <!-- Managers can see all schedules -->
        <record id="scientific_schedule_manager_rule" model="ir.rule">
            <field name="name">Schedule: Manager Access</field>
            <field name="model_id" ref="model_scientific_schedule"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_manager'))]"/>
        </record>

        <!-- Users can see all schedules (for coordination) -->
        <record id="scientific_schedule_user_rule" model="ir.rule">
            <field name="name">Schedule: User Access</field>
            <field name="model_id" ref="model_scientific_schedule"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_researcher'))]"/>
        </record>

        <!-- TAGS RULES -->
        <!-- All users can see and use tags -->
        <record id="scientific_tags_user_rule" model="ir.rule">
            <field name="name">Tags: User Access</field>
            <field name="model_id" ref="model_scientific_tags"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_scientific_researcher'))]"/>
        </record>

    </data>
</odoo>
